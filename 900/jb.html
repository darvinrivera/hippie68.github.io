<html>
<style>
    body {
        height: 100%;
        margin: 16px;
        overflow: hidden;
    }

    #container {
        border: 1px solid black;
        box-shadow: 0 0 16px rgba(0, 0, 0, 0.5);
        display: inline-block;
        font-size: large;
    }

    #title {
        font-weight: bold;
        padding: 8px;
    }

    #log_area {
        border: 1px solid black;
        border-style: solid none none;
        padding: 8px;
    }
</style>
<body onload="setTimeout(poc, 30);">
<div id="container">
    <div id="title"></div>
    <div id="log_area"></div>
</div>
<script>
let enable_debug = localStorage.getItem("enable_debug");
let webkit_addr = localStorage.getItem("webkit_addr");
if (webkit_addr === null)
    var GUESS_FONT = 0x200c00000;
else
    var GUESS_FONT = parseInt(webkit_addr);
let payloadFileNames = document.location.hash.substr(1).split(",");
let logArea = document.getElementById("log_area");

// Create info box.
{
    let title = document.getElementById("title");
    title.innerHTML = "Now jailbreaking with \"" + payloadFileNames.join(", ") + "\"";

    // Applies a color scheme.
    function setColors(background1, background2, highlight, border, text1, text2 = text1) {
        container.style.borderColor = border;
        title.style.backgroundColor = background1;
        title.style.borderColor = border;
        title.style.color = text1;
        logArea.style.backgroundColor = background2;
        logArea.style.borderColor = border;
        logArea.style.color = text2;
    }

    // Load color scheme.
    let color_scheme = localStorage.getItem("color_scheme");
    switch (color_scheme) {
        case "cappuccino":
            setColors("#3A2E2E", "#D6B79F", "sienna", "#816C61", "#F7ECDF", "#4B3832");
            break;
        case "dark":
            setColors("#333333", "#666666", "#444444", "#AAAAAA", "#DDDDDD");
            break;
        case "lavender":
            setColors("lavender", "#F5F5FA", "thistle", "darkorchid", "indigo");
            break;
        case "midnightblue":
            setColors("midnightblue", "royalblue", "tomato", "#A9BBF1", "white");
            break;
        case "pink":
            setColors("#934A70", "#BC7B9C", "#763C59", "#D8B2C5", "#F5ECF1");
            break;
        case "rojigualda":
            setColors("#AA151B", "#F1BF00", "#800F14", "#D7810A", "#F1BF00", "#AA151B");
            break;
        case "usa":
            setColors("#9B1C2C", "#33335F", "#33335F", "#CCC8BF", "#E3DED4");
            break;
        case "wheat":
            setColors("wheat", "#FFFBF2", "burlywood", "saddlebrown", "maroon");
            break;
        case "wildberry":
            setColors("#550000", "#AA3939", "#801515", "#E6C7C7", "#FFDDDD");
            break;
        default: // "gray"
            setColors("#F0F0F0", "white", "#D7D7D7", "gray", "black");
    }
}

// Displays a message inside the info box.
function logMessage(message) {
    logArea.innerHTML += "[+] " + message + "<br>";
}

// Displays a message at the top of the PS4 browser.
function debugMessage(msg) {
    if (enable_debug)
        document.title = msg;
}

// Runs code from a single JavaScript file.
function runScript(script) {
    let xhr = new XMLHttpRequest();
    xhr.open("GET", script, false);
    xhr.send("");
    try {
        eval.call(window, xhr.responseText);
    } catch (e) {
        alert(e + "\n" + e.stack);
    }
}

function done() {
    // Load Web Activator's frontend.
    if (payloadFileNames.includes("payloads/web_activator.bin")) {
        runScript("payloads/web_activator_frontend.js");
    }

    // Confirm exit for browser payloads.
    let browserPayloads = [];
    payloadFileNames.forEach(function (payloadFileName) {
        let name = payloadFileName.toLowerCase();
        if (name.includes("dumper") || name.includes("ftp"))
            browserPayloads.push(payloadFileName);
    });
    if (browserPayloads.length > 0)
        alert("The following payloads were started inside the PS4 browser and will stop when you close this window:\n\n   - "
            + browserPayloads.join("\n   - "));

    history.pushState({}, "", ".");
    if (localStorage.getItem("disable_youreallset") != 1)
        alert("You're all set!");

    // Only return if Web Activator's frontend is not used.
    if (!payloadFileNames.includes("payloads/web_activator.bin"))
        setTimeout(function() { read_ptr_at(0); }, 1);
}

logMessage("Please wait...");
</script>
<script src="bzip2.js"></script>
<script src="int64.js"></script>
<script src="rop.js"></script>
<script src="kexploit.js"></script>
<script src="webkit.js"></script>
</body>
</html>
